---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="JSON Formatter">
  <style>
    h1 {
      margin-bottom: 20px;
    }

    label {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      flex: 1;
      background: var(--bg-input);
      color: var(--text-main);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    pre {
      flex: 1;
      background: #111;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 14px;
      font-family: ui-monospace, monospace;
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
      overflow: auto;
    }

    textarea,
    pre {
      margin: 0;
      box-sizing: border-box;
    }

    .tool-panel {
      display: flex;
      flex-direction: column;
      min-height: 380px;
    }

    .tool-actions {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 12px;
      padding-top: 24px;
    }

    .tool-actions button {
      width: 100%;
    }

    .error {
      color: #ff6b6b;
    }
  </style>

  <h1>JSON Formatter</h1>

  <div class="tool-grid">
    <!-- INPUT -->
    <div class="tool-panel">
      <label for="input">Input</label>
      <textarea
        id="input"
        placeholder='{ "hello": "world" }'
      ></textarea>
    </div>

    <!-- ACTIONS -->
    <div class="tool-actions">
      <button id="beautify" class="btn-action">
        <span>Beautify</span>
      </button>
      <button id="compact" class="btn-action">
        <span>Compact</span>
      </button>
    </div>

    <!-- OUTPUT -->
    <div class="tool-panel">
      <label>Output</label>
      <pre id="result"></pre>
    </div>
  </div>

  <script type="module">
    import { formatJson } from '/_core/format.js';

    const input = document.getElementById('input');
    const result = document.getElementById('result');
    const btnBeautify = document.getElementById('beautify');
    const btnCompact = document.getElementById('compact');

    function clearResult() {
      result.textContent = '';
      result.classList.remove('error');
    }

    function hasInput() {
      return input.value.trim().length > 0;
    }

    function updateButtons() {
      const enabled = hasInput();
      btnBeautify.disabled = !enabled;
      btnCompact.disabled = !enabled;
    }

    function run(mode) {
      clearResult();

      const value = input.value.trim();
      if (!value) return;

      try {
        if (mode === 'beautify') {
          const out = formatJson(value);
          if (!out.ok) throw new Error(out.error);
          result.textContent = out.formatted;
        }

        if (mode === 'compact') {
          const parsed = JSON.parse(value);
          result.textContent = JSON.stringify(parsed);
        }
      } catch (err) {
        result.textContent =
          err instanceof Error ? err.message : 'Invalid JSON';
        result.classList.add('error');
      }
    }

    input.addEventListener('input', updateButtons);
    updateButtons();

    btnBeautify.onclick = () => run('beautify');
    btnCompact.onclick = () => run('compact');

    // Ctrl / Cmd + Enter â†’ Beautify
    input.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        run('beautify');
      }
    });
  </script>
</BaseLayout>
