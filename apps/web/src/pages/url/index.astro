---
import { encodeUrl, decodeUrl } from '../../../../../packages/core';

let output: string | null = null;
let error: string | null = null;

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData();
  const input = formData.get('input')?.toString() ?? '';
  const action = formData.get('action')?.toString();

  try {
    if (action === 'encode') {
      output = encodeUrl(input);
    } else if (action === 'decode') {
      output = decodeUrl(input);
    } else {
      error = 'Unknown action';
    }
  } catch (e) {
    error = (e as Error).message;
  }
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>URL Encode / Decode â€“ ddev-tools</title>
    <style>
      textarea { width: 100%; min-height: 160px; }
      pre { background: #111; color: #0f0; padding: 12px; white-space: pre-wrap; }
      .error { color: red; }
      .actions { margin-top: 8px; }
      button { margin-right: 8px; }
    </style>
  </head>
  <body>
    <h1>URL Encode / Decode</h1>

    <form method="post">
      <textarea
        name="input"
        placeholder="Paste URL or text here"
      ></textarea>

      <div class="actions">
        <button name="action" value="encode">Encode</button>
        <button name="action" value="decode">Decode</button>
      </div>
    </form>

    {error && <p class="error">Error: {error}</p>}
    {output && <pre>{output}</pre>}
  </body>
</html>
